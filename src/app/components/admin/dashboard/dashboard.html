<!-- Global Standardized Loader -->
<div class="full-page-loader" *ngIf="isLoading">
    <div class="loader-content">
        <img src="assets/logo.png" alt="WG Logo" class="loader-logo">
        <div class="loader-footer">
            <div class="loader-spinner"></div>
            <p class="loader-text">Cargando el panel</p>
        </div>
    </div>
</div>

<div class="dashboard-container fade-in" *ngIf="!isLoading && userData">
    <!-- Admin Top Bar -->
    <div class="admin-topbar">
        <div class="admin-topbar-left">
            <img src="assets/logo.png" alt="WG" class="admin-topbar-logo" routerLink="/">
        </div>
        <div class="admin-topbar-nav">
            <button class="topbar-btn" routerLink="/"> Landing</button>
            <button class="topbar-btn" routerLink="/admin/settings">锔 Ajustes</button>
            <button class="topbar-btn" routerLink="/admin/subscription"> Suscripci贸n</button>
            <button class="topbar-btn btn-logout" (click)="logout()"> Cerrar sesi贸n</button>
        </div>
    </div>

    <div class="dashboard-header">
        <div>
            <h2>隆Hola, {{ userData.empresa || userData.nombre }}! </h2>
            <p class="subtitle">Bienvenido a tu panel de control central.</p>
        </div>
        <div class="status-badge" [ngClass]="userData.estadoSuscripcion">
            {{ userData.estadoSuscripcion === 'trial' ? 'En Per铆odo de Prueba' : 'Suscripci贸n Activa' }}
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Tarjeta del QR -->
        <div class="dashboard-card qr-card">
            <h3>Tu C贸digo QR</h3>
            <p class="card-desc">Tus clientes pueden escanear esto o pod茅s usarlo para vincular WhatsApp.</p>

            <div class="qr-wrapper" *ngIf="userData.qrUrl">
                <img [src]="userData.qrUrl" alt="C贸digo QR de tu negocio" class="qr-image" />
            </div>

            <div class="qr-placeholder" *ngIf="!userData.qrUrl">
                <p>Generando c贸digo QR...</p>
            </div>
        </div>

        <!-- Tarjeta de M茅tricas -->
        <div class="dashboard-card metrics-card">
            <h3>Dispositivos Vinculados</h3>

            <div class="metric-number">
                {{ vinculacionesCount }}
            </div>
            <p class="card-desc">Dispositivos activos comunic谩ndose con tu chatbot.</p>

            <div class="action-buttons">
                <button class="btn btn-secondary" (click)="editData()">锔 Editar Datos</button>
                <button class="btn btn-primary" (click)="manageSubscription()"> Administrar Suscripci贸n</button>
            </div>
        </div>
    </div>
</div>