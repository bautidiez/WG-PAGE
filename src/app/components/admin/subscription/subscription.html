<!-- Global Standardized Loader -->
<div class="full-page-loader" *ngIf="isLoading">
    <div class="loader-content">
        <img src="assets/logo.png" alt="WG Logo" class="loader-logo">
        <div class="loader-footer">
            <div class="loader-spinner"></div>
            <p class="loader-text">Cargando planes</p>
        </div>
    </div>
</div>

<div class="subscription-container fade-in" *ngIf="!isLoading && userData">

    <button class="btn-back" (click)="goBack()" *ngIf="!isTrialExpired && userData.estadoSuscripcion !== 'vencida'">
        â† Volver al Dashboard
    </button>

    <div class="header-text">
        <h2>Administrador de SuscripciÃ³n ğŸ’³</h2>
        <p *ngIf="isTrialExpired || userData.estadoSuscripcion === 'vencida'" class="alert-expire">
            Tu perÃ­odo de prueba ha expirado. Por favor, selecciona un plan para seguir utilizando la plataforma.
        </p>
        <p *ngIf="!isTrialExpired && userData.estadoSuscripcion === 'trial'" class="alert-trial">
            EstÃ¡s disfrutando de tu prueba de 7 dÃ­as. Â¡ElegÃ­ un plan para no tener interrupciones!
        </p>
    </div>

    <div class="plans-grid" *ngIf="userData.estadoSuscripcion === 'trial' || userData.estadoSuscripcion === 'vencida'">

        <!-- Plan Mensual -->
        <div class="plan-card">
            <h3>Plan Mensual</h3>
            <div class="price">$15.000 <span>/mes</span></div>
            <ul class="features">
                <li>âœ… Dispositivos ilimitados</li>
                <li>âœ… Soporte 24/7</li>
                <li>âœ… EdiciÃ³n de respuestas en vivo</li>
            </ul>
            <button class="btn-subscribe" (click)="selectPlan('price_mensual_id')">Suscribirme Mensual</button>
        </div>

        <!-- Plan Anual (Destacado) -->
        <div class="plan-card featured">
            <div class="badge">AhorrÃ¡ 2 Meses</div>
            <h3>Plan Anual</h3>
            <div class="price">$150.000 <span>/aÃ±o</span></div>
            <ul class="features">
                <li>âœ… Todo lo del plan mensual</li>
                <li>âœ… FacturaciÃ³n simplificada</li>
                <li>âœ… 2 Meses bonificados</li>
            </ul>
            <button class="btn-subscribe prime" (click)="selectPlan('price_anual_id')">Suscribirme Anual</button>
        </div>
    </div>

    <!-- Usuario ya suscrito -->
    <div class="active-subscription-card" *ngIf="userData.estadoSuscripcion === 'activa'">
        <h3>Â¡Tu suscripciÃ³n estÃ¡ activa! ğŸ‰</h3>
        <p>Gracias por confiar en nosotros. PodÃ©s descargar tus facturas o cancelar tu plan desde el Portal Seguro de
            Stripe.</p>

        <button class="btn-portal" (click)="openCustomerPortal()">
            âš™ï¸ Administrar FacturaciÃ³n en Stripe
        </button>
    </div>

</div>