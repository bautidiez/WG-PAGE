<!-- Global Standardized Loader -->
<div class="full-page-loader" *ngIf="isLoading">
    <div class="loader-content">
        <img src="assets/logo.png" alt="WG Logo" class="loader-logo">
        <div class="loader-footer">
            <div class="loader-spinner"></div>
            <p class="loader-text">Cargando planes</p>
        </div>
    </div>
</div>

<div class="subscription-container fade-in" *ngIf="!isLoading && userData">
    <!-- Admin Top Bar -->
    <div class="admin-topbar">
        <div class="admin-topbar-left">
            <img src="assets/logo.png" alt="WG" class="admin-topbar-logo" routerLink="/">
        </div>
        <div class="admin-topbar-nav">
            <button class="topbar-btn" routerLink="/admin/dashboard">ğŸ“Š Dashboard</button>
            <button class="topbar-btn" routerLink="/">ğŸ  Landing</button>
            <button class="topbar-btn btn-logout" (click)="logout()">ğŸšª Cerrar sesiÃ³n</button>
        </div>
    </div>


    <div class="header-text">
        <h2>Administrador de SuscripciÃ³n ğŸ’³</h2>
        <p *ngIf="isTrialExpired || userData.estadoSuscripcion === 'vencida'" class="alert-expire">
            Tu perÃ­odo de prueba ha expirado. SeleccionÃ¡ un plan para seguir utilizando la plataforma.
        </p>
        <p *ngIf="!isTrialExpired && userData.estadoSuscripcion === 'trial'" class="alert-trial">
            EstÃ¡s disfrutando de tu prueba de 7 dÃ­as. Â¡ElegÃ­ un plan para no tener interrupciones!
        </p>

        <!-- Currency Toggle (igual que landing) -->
        <div class="currency-selector" *ngIf="userData.estadoSuscripcion === 'trial' || userData.estadoSuscripcion === 'vencida'">
            <button class="currency-btn" [class.active]="currentCurrency === 'USD'" (click)="currentCurrency = 'USD'">
                USD ($)
            </button>
            <button class="currency-btn" [class.active]="currentCurrency === 'ARS'" (click)="currentCurrency = 'ARS'">
                ARS ($)
            </button>
        </div>

        <div class="exchange-info" *ngIf="currentCurrency === 'ARS'">
            <span class="exchange-icon">ğŸ’±</span>
            <span>{{ getExchangeInfo() }}</span>
            <button class="refresh-btn" (click)="fetchExchangeRate()" [disabled]="isLoadingRate">
                <span [class.spinning]="isLoadingRate">ğŸ”„</span>
            </button>
        </div>
    </div>

    <!-- Plans Grid (side by side) -->
    <div class="plans-grid" *ngIf="userData.estadoSuscripcion === 'trial' || userData.estadoSuscripcion === 'vencida'">
        <div class="plan-card" *ngFor="let plan of plans" [class.featured]="plan.featured">
            <div class="badge" *ngIf="plan.badge">{{ plan.badge }}</div>
            <h3>Plan {{ plan.name }}</h3>
            <div class="price">
                {{ formatPrice(plan.priceUSD) }}
                <span class="currency-label">{{ getCurrencyLabel() }}</span>
                <span>{{ plan.period }}</span>
            </div>
            <ul class="features">
                <li *ngFor="let feature of plan.features">âœ… {{ feature }}</li>
            </ul>
            <button class="btn-subscribe" [class.prime]="plan.featured" (click)="selectPlan(plan.stripePriceId)">
                Suscribirme {{ plan.name }}
            </button>
        </div>
    </div>

    <!-- Usuario ya suscrito -->
    <div class="active-subscription-card" *ngIf="userData.estadoSuscripcion === 'activa'">
        <h3>Â¡Tu suscripciÃ³n estÃ¡ activa! ğŸ‰</h3>
        <p>Gracias por confiar en nosotros. PodÃ©s descargar tus facturas o cancelar tu plan desde el Portal Seguro de
            Stripe.</p>

        <button class="btn-portal" (click)="openCustomerPortal()">
            âš™ï¸ Administrar FacturaciÃ³n en Stripe
        </button>
    </div>

</div>